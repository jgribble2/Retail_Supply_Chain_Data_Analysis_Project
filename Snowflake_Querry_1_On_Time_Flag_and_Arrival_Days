SELECT
    SH.*,
    CASE
        WHEN SH.ARRIVAL_DATE IS NULL THEN NULL
        WHEN SH.ARRIVAL_DATE <= PO.EXPECTED_DELIVERY THEN 1
        ELSE 0
    END AS ON_TIME_FLAG,
    DATEDIFF(day, SH.SHIP_DATE, SH.ARRIVAL_DATE) AS TRANSIT_DAYS
FROM
  "RETAIL_SUPPLY_CHAIN_DATA_PROJECT"."PUBLIC"."SHIPMENTS" AS SH
JOIN
    "RETAIL_SUPPLY_CHAIN_DATA_PROJECT"."PUBLIC"."PURCHASE_ORDERS" AS PO
    ON SH.PO_ID = PO.PO_ID
